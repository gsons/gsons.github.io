<extend name="Tpl:Base" />
<block name="body">
    <!-- Main content -->
    <section class="content">

        <div class="box we-media">
            <div class="box-header with-border">
                <h3 class="box-title iframe-title">音频素材管理</h3>
                <neq name="static" value="1">
                    <div class="btn-toolbar">
                        <a href="javascript:" class="btn btn-success" id="avatar" >上传素材</a>
                        <span class="ext">允许上传的格式：{$uf.ext}，大小：{$uf.max|format_bytes}，且长度不超过60秒</span>
                        <input id="file_upload" name="file_upload" type="file" multiple="true">
                    </div>
                </neq>
            </div><!-- /.box-header -->
            <div class="box-body we-image">
                <div class="container-fluid">
                    <div class="row" id="we-image-list">
                        <volist name="list" id="vo" key="i">
                            <div class="box" data-id="{$vo.id}">
                                <div class="box-header">
                                    <h3 class="box-title">{$vo.title}</h3>
                                    <div class="box-tools pull-right">
                                        <button class="btn btn-box-tool" onclick="DeleteMedia(this);"><i class="fa fa-times"></i></button>
                                    </div><!-- /.box-tools -->
                                </div>
                                <div class="box-body">
                                    <div id="jquery_jplayer_{$i}" class="jp-jplayer"></div>
                                    <div id="jp_container_{$i}" class="jp-audio-stream" role="application" aria-label="media player">
                                        <div class="jp-type-single">
                                            <div class="jp-gui jp-interface">
                                                <div class="jp-controls">
                                                    <button class="jp-play" role="button" tabindex="0">play</button>
                                                </div>
                                                <div class="jp-volume-controls">
                                                    <button class="jp-mute" role="button" tabindex="0">mute</button>
                                                    <button class="jp-volume-max" role="button" tabindex="0">max volume</button>
                                                    <div class="jp-volume-bar">
                                                        <div class="jp-volume-bar-value"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="jp-details">
                                                <div class="jp-title" aria-label="title">&nbsp;</div>
                                            </div>
                                            <div class="jp-no-solution">
                                                <span>Update Required</span>
                                                To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </volist>
                    </div>
                </div>

            </div><!-- /.box-body -->
            <div class="box-footer">
                <!--<ul class="pagination">
                    <li class="paginate_button previous disabled"><a href="#" >上一页</a> </li>
                    <li class="paginate_button active"><a href="#">1</a></li>
                    <li class="paginate_button "><a href="#">2</a></li>
                    <li class="paginate_button next"><a href="#">下一页</a></li>
                </ul>-->
                {$page}
            </div>
        </div>

    </section><!-- /.content -->
</block>
<block name="script">
    <script src="__PLUS__/uploadifive/jquery.uploadifive.min.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="__PLUS__/uploadifive/uploadifive.css">
    <script type="text/javascript">
        var $file = $('#file_upload');
        $('#file_upload').uploadifive({
            'auto'             : true,
            'removeCompleted' : true,
            'buttonClass'  : 'hide',
            'buttonText'   : '选择音频',
            'height':34,
            'uploadScript'     :'{:U("Public/UploadFile",array("type"=>"voice"))}',
            'onUploadComplete' : function(file, data) {
                loading();
                var data = JSON.parse(data);
                if( data.status == '1' ) {
                    $.ajax({
                        url: '{:U("")}',
                        data: data.info,
                        type: 'post',
                        dataType: 'json',
                        success: function (data) {
                            if (data.status == '1') {
                                layer.msg('添加成功',{icon:1,time:2000},function(){
                                    window.location.reload();
                                })
                            } else if (data.status == '0') {
                                layer.msg(data.info)
                            } else {
                                layer.msg(data)
                            }
                            loaded();
                        },
                        error: function () {
                            layer.msg('系统错误，请稍后再试');
                            loaded();
                        }
                    })
                }else{
                    layer.msg(data.info)
                    loaded();
                }
            }
        });
        $('#uploadifive-file_upload').css({'line-height':'20px','margin-bottom':'10px','margin-top':'10px','margin-left':'5px'})
        $('#avatar').click(function(){
            $file.next().trigger('click');
            $file = $file.next()
        })
    </script>

    <link href="__PLUS__/jPlayer-2.9.1/skin/blue.monday/jplayer.blue.monday.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="__PLUS__/jPlayer-2.9.1/dist/jplayer/jquery.jplayer.min.js"></script>
    <volist name="list" id="vo" key="i">
        <script>
            $(function(){
                $("#jquery_jplayer_{$i}").jPlayer({
                    ready: function () {
                        $(this).jPlayer("setMedia", {
                            title: "{$vo.title}",
                            mp3: "__UPLOAD__/{$vo.src}",
                            wav: "__UPLOAD__/{$vo.src}",
                            wma: "__UPLOAD__/{$vo.src}",
                            amr: "__UPLOAD__/{$vo.src}"
                        });
                    },
                    swfPath: "__PLUS__/jPlayer-2.9.1/dist/jplayer",
                    supplied: "mp3,wav,wma,amr",
                    cssSelectorAncestor: "#jp_container_{$i}",
                    wmode: "window",
                    globalVolume: true,
                    useStateClassSkin: true,
                    autoBlur: false,
                    smoothPlayBar: true,
                    keyEnabled: true
                });
            })

        </script>
    </volist>
</block>