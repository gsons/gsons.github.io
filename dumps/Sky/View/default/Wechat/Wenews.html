<include file="Public:Config" />
<body>
<div class="iframe-content">
    <div class="topic">
        图文信息回复
    </div>
    <div class="textgroup">
        <form action="" method="post" id="Wenew">
            <table>
                <tr>
                    <td colspan="2" class="theme-panel" align="center">图文信息</td>
                </tr>
                <tr></tr>
                <tr>
                    <th>
                        触发关键字：
                    </th>
                    <td>
                        <input type="text" name="id[]" class="hide" value="{$News[0].id}" />
                        <input type="text" name="keyword" class="input" placeholder="请输入关键字" value="{$Keyword.keyword}" <PHP>if(!empty($Keyword)) { echo 'disabled'; }  </PHP> />
                    </td>
                </tr>
                <tr>
                    <th></th>
                    <td><span class="theme-font">请输入触发该内容的关键字，用户向微信平台发送以上所填内容时，服务器则会回复以下所填的文本信息给用户</span></td>
                </tr>
                <tr>
                    <th>
                        标题：
                    </th>
                    <td>
                        <input type="text" name="title[]" class="input" placeholder="请输入图文标题" value="{$News[0].title}" />
                    </td>
                </tr>
                <tr>
                    <th></th>
                    <td><span class="theme-font">请输入该图文消息的小标题</span></td>
                </tr>
                <tr>
                    <th>
                        链接：
                    </th>
                    <td>
                        <input type="text" name="url[]" class="input" placeholder="请输入图文信息跳转的链接" value="{$News[0].url}" />
                    </td>
                </tr>
                <tr>
                    <th></th>
                    <td><span class="theme-font">请输入图文信息跳转的链接</span></td>
                </tr>
                <tr>
                    <th>
                        简介：
                    </th>
                    <td>
                        <textarea name="imgdesc[]" class="input" style="width:80%;height:70px;">{$News[0].imgdesc}</textarea>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td><span class="theme-font">请输入该图文消息的简介</span></td>
                </tr>
                <tr>
                    <th>
                        封面图片：
                    </th>
                    <td>
                        <div class="corver1" style="width:360px;height:200px;border:1px solid #f1f1f1;margin-bottom:5px;overflow:hidden">
                            <notempty name="News[0].corver" >
                                <img style="width:100%;" src="{$News[0].corver|get_image}" alt=""/>
                            </notempty>
                        </div>
                        <input type="text" name="corver[]" class="corver1-input hide" value="{$News[0].corver}" />
                        <a href="javascript:;" onclick="AlertImageBox('#webuploader','.corver1')" class="btn btn-primary select-shake-corver">选择图片</a>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td><span class="theme-font">请上传封面图片，推荐大小（360像素x200像素），图片过大则会只显示图片正中间360X200的区域</span></td>
                </tr>
            </table>

            <hr class="hr"/>

            <volist name="News" id="vo" key="i">
                <if condition="$i neq 1">
                    <table class="images" style="margin-top:40px;">
                        <tr class="theme-panel">
                            <td style="position:relative;" colspan="2" align="center">图文消息---小图文  <a href="javascript:" class="btn btn-danger removeNew">删除本消息</a></td>
                        </tr>
                        <tr style="height:80px;">
                            <th>
                                标题：
                            </th>
                            <td>
                                <input type="text" name="id[]" class="hide" value="{$vo.id}" />
                                <input type="text" name="title[]" class="input" placeholder="请输入标题" value="{$vo.title}" />
                            </td>
                        </tr>
                        <tr>
                            <th></th>
                            <td><span class="theme-font">请输入该图文消息的小标题</span></td>
                        </tr>
                        <tr>
                            <th>
                                链接：
                            </th>
                            <td>
                                <input type="text" name="url[]" class="input" placeholder="请输入链接" value="{$vo.url}" />
                            </td>
                        </tr>
                        <tr>
                            <th></th>
                            <td><span class="theme-font">请输入点击图文消息后跳转的地址</span></td>
                        </tr>
                        <tr>
                            <th>
                                简介：
                            </th>
                            <td>
                                <textarea name="imgdesc[]" class="input" style="width:80%;height:70px;">{$vo.imgdesc}</textarea>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td><span class="theme-font">请输入该图文消息的简介</span></td>
                        </tr>
                        <tr>
                            <th>
                                封面图片：
                            </th>
                            <td>
                                <div class="corver{$i}" style="width:200px;height:200px;border:1px solid #f1f1f1;margin-bottom:5px;">
                                    <img style="width:100%;height:100%;" src="{$vo.corver|get_image}" alt=""/>
                                </div>
                                <input type="text" name="corver[]" class="corver{$i}-input hide" value="{$vo.corver}" />
                                <a href="javascript:;" onclick="AlertImageBox('#webuploader','.corver{$i}')" class="btn btn-primary select-shake-corver">选择图片</a>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td><span class="theme-font">请上传封面图片，推荐大小（200像素x200像素）</span></td>
                        </tr>
                    </table>
                </if>
            </volist>

            <table class="submit-table" style="border-top:1px solid #f1f1f1;">
                <tr>
                    <td></td>
                    <td><button class="btn btn-success getmoreimages">继续添加图文消息</button></td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <input type="submit" class="btn btn-info" value="提交" onclick="Ajax_submit(this);return false;" data-form="Wenew" />
                        <input type="reset" class="btn btn-warning" value="重置"/>
                    </td>
                </tr>
            </table>
        </form>
    </div>
    <div class="textlist">
        <div class="theme-panel title">
            图文回复关键字列表
        </div>
        <ul>
            <foreach name="text_kl" item="item">
                <li><a href="{:U('Wenews',array('kid'=>$item['id']))}">{$item.keyword}</a></li>
            </foreach>
        </ul>
    </div>
    {:hook('Imagesupload')}
</div>
</body>
</html>
<script>

    var now = $('.images').length;
    now = now + 2 ;
    $('.getmoreimages').click(function(){
        var length = $('.images').length;
        var snews = '' +
                '<table class="images" style="margin-top:40px;"> ' +
                '<tr class="theme-panel"> ' +
                '<td style="position:relative;" colspan="2" align="center">图文消息---小图文  <a href="javascript:" class="btn btn-danger removeNew">删除本消息</a></td> ' +
                '</tr> ' +
                '<tr style="height:80px;"> ' +
                '<th>' +
                '标题： ' +
                '</th> ' +
                '<td> ' +
                '<input type="text" name="title[]" class="input" placeholder="请输入标题"/> ' +
                '</td> ' +
                '</tr> ' +
                '<tr> ' +
                '<th></th> ' +
                '<td><span class="theme-font">请输入该图文消息的小标题</span></td> ' +
                '</tr> ' +
                '<tr> ' +
                '<th>' +
                '链接： ' +
                '</th> ' +
                '<td> ' +
                '<input type="text" name="url[]" class="input" placeholder="请输入链接"/> ' +
                '</td> ' +
                '</tr> ' +
                '<tr> ' +
                '<th></th> ' +
                '<td><span class="theme-font">请输入点击图文消息后跳转的地址</span></td> ' +
                '</tr> ' +
                '<tr> ' +
                '<th>' +
                '简介： ' +
                '</th> ' +
                '<td> ' +
                '<textarea name="imgdesc[]" class="input" style="width:80%;height:70px;"></textarea> ' +
                '</td> ' +
                '</tr> ' +
                '<tr> ' +
                '<td></td> ' +
                '<td><span class="theme-font">请输入该图文消息的简介</span></td> ' +
                '</tr> ' +
                '<tr> ' +
                '<th>' +
                '封面图片： ' +
                '</th> ' +
                '<td> ' +
                '<div class="corver'+(now)+'" style="width:200px;height:200px;border:1px solid #f1f1f1;margin-bottom:5px;"> ' +
                '</div> ' +
                '<input type="text" name="corver[]" class="corver'+(now)+'-input hide"/> ' +
                '<a href="javascript:;" onclick="AlertImageBox('+"'#webuploader','.corver"+(now)+"')"+'" class="btn btn-primary select-shake-corver">选择图片</a> ' +
                '</td> '+
                '</tr> ' +
                '<tr> <td></td> <td><span class="theme-font">请上传封面图片，推荐大小（200像素x200像素）</span></td> </tr> </table>'

        if( length > 8 ){
            $(this).html('文本信息最多只能一次性添加10条')
            return  false ;
        }else {
            now++;
            $('.submit-table').before(snews);
            return false;
        }
    })

    $('.removeNew').live('click',(function(){
        $(this).parent().parent().parent().parent().remove();
    }))

</script>