<extend name="Tpl:Base"/>
<block name="body">
<style>
    .delete a{
        position: absolute;
        right: 30px;
    }
</style>
    <!-- Main content -->
    <section class="content">
        <a href="#" class="ion-reply history-back" onclick="history.back(1)">&nbsp;返回</a>
        <div class="nav-tabs-custom">
            <form action="" id="form">
                <div class="box box-success">
                    <div class="box-header with-border">
                        <h3 class="box-title">在线访谈增加/修改</h3>
                    </div>
                    <div class="box-body">
                        <div class="form-group">
                            <label><span class="text-red">*</span> 标题：</label>
                            <input type="text" class="form-control" placeholder="标题" name="title" value="{$info.title}">
                        </div>
                        <br>

                        <div class="form-group">
                            <label><span class="text-red">*</span> 访谈时间：</label>
                            <input type="text" class="form-control" placeholder="访谈时间" name="interview_time" value="{$info.interview_time}">
                        </div>
                        <br>

                        <div class="form-group">
                            <label><span class="text-red">*</span> 访谈地点：</label>
                            <input type="text" class="form-control" placeholder="访谈地点" name="interview_place" value="{$info.interview_place}">
                        </div>
                        <br>

                        <div class="form-group">
                            <label><span class="text-red">*</span> 访谈嘉宾</label>
                            <input type="text" class="form-control" placeholder="访谈嘉宾" name="interview_guest" value="{$info.interview_guest}">
                        </div>
                        <br>

                        <div class="form-group">
                            <label><span class="text-red">*</span> 访谈摘要</label>
                            <input type="text" class="form-control" placeholder="访谈摘要" name="interview_description" value="{$info.interview_description}">
                        </div>
                        <br>

                        <div class="form-group">
                            <label><span class="text-red">*</span> 直播图片：</label>
                            <input type="file" name="pic" id="pic_upload"/>
                            <div id="queue">
                                <notempty name="info.picture">
                                    <volist name=":json_decode($info['picture'],true)" id="src">
                                    <div class="delete"><a href="javasctipt:;"  onclick="delete_picture(this)">X</a><img style="max-width:100%;" src="__UPLOAD__/{$src}" alt=""/> <input type="hidden" name="picture[]" value="{$src}"/>
                                    </div>
                                    </volist>
                                </notempty>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><span class="text-red">*</span> 直播内容：</label>
                            <script name="content" id="details" type="text/plain" style="height:300px;">
                                {$info.content|htmlspecialchars_decode|makeImgSrc}
                            </script>
                        </div>
                        <br>

                    </div>
                    <!-- /.box-body -->
                    <div class="box-footer">
                        <input type="hidden" name="id" value="{:I('get.id')}" />
                        <button type="button" class="btn btn-primary ajax-submit ajax-post" data-form="form">提交</button>
                    </div>
                </div>
            </form>

        </div>

    </section>
    <!-- /.content -->

</block>
<block name="script">
<script src="__PLUS__/ueditor/ueditor.config.js"></script>
<script src="__PLUS__/ueditor/ueditor.all.min.js"></script>
<script src="__PLUS__/ueditor/ueditor.parse.min.js"></script>
<script>
    var ue = UE.getEditor('details', {
        toolbars: [[
            'undo', 'redo', '|',
            'bold', 'italic', 'underline', 'fontborder', 'strikethrough', 'superscript', 'subscript', 'removeformat', 'formatmatch', 'autotypeset', 'blockquote', 'pasteplain', '|', 'forecolor', 'backcolor', 'insertorderedlist', 'insertunorderedlist', 'selectall', 'cleardoc', '|',
            'rowspacingtop', 'rowspacingbottom', 'lineheight', '|',
            'fontfamily', 'fontsize', '|',
            'directionalityltr', 'directionalityrtl', 'indent', '|',
            'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|', 'touppercase', 'tolowercase', '|',
            'link', 'unlink', 'anchor', '|', 'imagenone', 'imageleft', 'imageright', 'imagecenter', '|',
            'simpleupload', 'insertimage','insertvideo', 'map', 'gmap', '|',
            'horizontal', 'date', 'time', 'spechars', 'snapscreen', 'wordimage', '|',
            'inserttable', 'deletetable', 'insertparagraphbeforetable', 'insertrow', 'deleterow', 'insertcol', 'deletecol', 'mergecells', 'mergeright', 'mergedown', 'splittocells', 'splittorows', 'splittocols', 'charts', '|',
            'drafts'
        ]]
    });
</script>
<script src="__PLUS__/uploadify/jquery.uploadify.min.js"></script>
<link rel="stylesheet" href="__PLUS__/uploadify/uploadify.css"/>
<script>
    function delete_picture(a){
        $(a).parent().remove();
    }

    var auid = '{:is_admin()}';
    $('#pic_upload').uploadify({
        'multi': true,
        'fileTypeExts': '*.gif; *.jpg; *.png',
        'formData': {'auid': auid},
        'buttonText': '上传',
        'swf': '__PLUS__/uploadify/uploadify.swf',
        'uploader': '{:U("Public/UploadFile",array("type"=>"image"))}',
        'height': 35,
        'width': 70,
        'onUploadSuccess': function (file, data, response) {
            var data = JSON.parse(data);
            if (data.status == '1') {
                var picker = '<div class="delete"><a href="javasctipt:;" onclick="delete_picture(this)">X</a><img style="max-width:100%;" src="__UPLOAD__/' + data.info.Filedata.savepath + '' + data.info.Filedata.savename + '" alt=""/> <input type="hidden" name="picture[]" value="' + data.info.Filedata.savepath + '' + data.info.Filedata.savename + '" /></div>';
                $('#queue').append(picker);
            } else if (data.status == '0') {
                layer.msg(data.info)
            } else {
                layer.msg(data)
            }
        }
    });

    $('#video_upload').uploadify({
        'multi': true,
        'fileTypeExts': '*.mp4; *.wmv *.flv',
        'formData': {'auid': auid},
        'buttonText': '上传',
        'swf': '__PLUS__/uploadify/uploadify.swf',
        'uploader': '{:U("Public/UploadFile",array("type"=>"video"))}',
        'height': 35,
        'width': 70,
        'onUploadSuccess': function (file, data, response) {
            var data = JSON.parse(data);
            if (data.status == '1') {
                var src = data.info.Filedata.savepath + '' + data.info.Filedata.savename;
                $('input[name=video_src]').val(src);
                $('input[name=video_name]').val(data.info.Filedata.name);
            } else if (data.status == '0') {
                layer.msg(data.info)
            } else {
                layer.msg(data)
            }
        }
    });

</script>

</block>