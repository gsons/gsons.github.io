<!DOCTYPE HTML>
<html lang="zh-CN">
	<head>
		<meta charset="GB2312">
		<title>字段映射</title>
		<link rel="stylesheet" href="../images/css/book.css">
		<link rel="stylesheet" href="../images/prettify/prettify.css">
		<script type="text/javascript" src="../images/js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="../images/prettify/prettify.js"></script>
		<script type="text/javascript">
			$(function(){	
				$(window).resize(function(){
					$('.book-content').css('min-height', $(window).height() - 130);
				}).resize();
				
				var $code = $(".book-content pre");
				$code.each(function(){
					var $this = $(this), $code = $this.children("code"), lang = $code.attr("class");
					$this.addClass("prettyprint linenums");
					lang && $this.addClass("lang-" + lang);					
				});
				
				//调用高亮插件，高亮代码
				prettyPrint();
				
				//解决表格存在边距的问题
				$("table").attr({"cellspacing":"0", "cellpadding":"0"});
				
				//快捷键翻页
				$(document).keydown(function(event){
					if(event.keyCode == 37){ //上一页
						$(".book-title .prev span").click();
					} else if(event.keyCode == 39) {//下一页
						$(".book-title .next span").click();
					}
				});
				
			});
		</script>
	</head>
	<body>
		<div class="book-title">
			<h1>字段映射</h1>
            <div class="page"><a title="上一页" class="prev" href="80.html"><span>上一页</span></a><a title="下一页" class="next" href="82.html"><span>下一页</span></a></div>
            <div class="description"></div>
		</div>
		<div class="book-content"><p>ThinkPHP的字段映射功能可以让你在表单中隐藏真正的数据表字段，而不用担心放弃自动创建表单对象的功能，假设我们的User表里面有username和email字段，我们需要映射成另外的字段，定义方式如下：</p>

<pre><code>namespace Home\Model;
use Think\Model;
Class UserModel extends Model{
     protected $_map = array(
         'name' =&gt;'username', // 把表单中name映射到数据表的username字段
         'mail'  =&gt;'email', // 把表单中的mail映射到数据表的email字段
     );
}
</code></pre>

<p>这样，在表单里面就可以直接使用name和mail名称作为表单数据提交了。我们使用<code>create</code>方法创建数据对象的时候，会自动转换成定义的实际数据表字段。</p>

<blockquote>
  <p>字段映射还可以支持对主键的映射。</p>
</blockquote>

<p>使用字段映射后，默认不会对读取的数据会自动处理，</p>

<pre><code>// 实例化User模型
$User = D('User');
$data = $User-&gt;find(3);
dump($data);
</code></pre>

<p>输出结果类似：</p>

<pre><code>array(size=4)
    'id'      =&gt; int 3
    'username'=&gt; string 'thinkphp'(length=8)
    'email'   =&gt; string 'thinkphp@gmail.com' (length=18)
    'status'  =&gt; int 1
</code></pre>

<p>这个时候取出的data数据包含的是实际的username和email字段。</p>

<p>如果我们需要在数据获取的时候自动处理的话，设置开启<code>READ_DATA_MAP</code>参数，</p>

<pre><code>'READ_DATA_MAP'=&gt;true
</code></pre>

<p>这个时候，输出结果类似：</p>

<pre><code>array(size=4)
    'id'      =&gt; int 3
    'name'    =&gt; string 'thinkphp'(length=8)
    'mail'    =&gt; string 'thinkphp@gmail.com' (length=18)
    'status'  =&gt; int 1
</code></pre>

<p>或者直接使用<code>parseFieldsMap</code>方法进行转换处理，例如：</p>

<pre><code>// 实例化User模型
$User = D('User');
$data = $User-&gt;find(3);
$data = $User-&gt;parseFieldsMap($data);
</code></pre>

<p>通过上面的两种方式后，无论是find还是select方法读取后的data数据中就包含了name和mail字段数据了，而不再有username和email字段数据了。</p>
</div>
		<div class="book-footer">
			<div class="page"><a title="上一页" class="prev" href="80.html"><span>上一页</span></a><a title="下一页" class="next" href="82.html"><span>下一页</span></a></div>
		</div>
	</body>
</html>
