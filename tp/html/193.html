<!DOCTYPE HTML>
<html lang="zh-CN">
	<head>
		<meta charset="GB2312">
		<title>验证码</title>
		<link rel="stylesheet" href="../images/css/book.css">
		<link rel="stylesheet" href="../images/prettify/prettify.css">
		<script type="text/javascript" src="../images/js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="../images/prettify/prettify.js"></script>
		<script type="text/javascript">
			$(function(){	
				$(window).resize(function(){
					$('.book-content').css('min-height', $(window).height() - 130);
				}).resize();
				
				var $code = $(".book-content pre");
				$code.each(function(){
					var $this = $(this), $code = $this.children("code"), lang = $code.attr("class");
					$this.addClass("prettyprint linenums");
					lang && $this.addClass("lang-" + lang);					
				});
				
				//调用高亮插件，高亮代码
				prettyPrint();
				
				//解决表格存在边距的问题
				$("table").attr({"cellspacing":"0", "cellpadding":"0"});
				
				//快捷键翻页
				$(document).keydown(function(event){
					if(event.keyCode == 37){ //上一页
						$(".book-title .prev span").click();
					} else if(event.keyCode == 39) {//下一页
						$(".book-title .next span").click();
					}
				});
				
			});
		</script>
	</head>
	<body>
		<div class="book-title">
			<h1>验证码</h1>
            <div class="page"><a title="上一页" class="prev" href="192.html"><span>上一页</span></a><a title="下一页" class="next" href="194.html"><span>下一页</span></a></div>
            <div class="description"></div>
		</div>
		<div class="book-content"><p>Think\Verify类可以支持验证码的生成和验证功能。</p>

<h2>生成验证码</h2>

<p>下面是最简单的方式生成验证码：</p>

<pre><code>$Verify = new \Think\Verify();
$Verify-&gt;entry();
</code></pre>

<p>上面的代码会生成默认的验证码图片并输出，显示如下：</p>

<p><img src="../images/img/6.png" alt="verify" /></p>

<p>生成的验证码信息会保存到session中，包含的数据有：</p>

<pre><code>array('verify_code'=&gt;'当前验证码的值','verify_time'=&gt;'验证码生成的时间戳')
</code></pre>

<p>如果你需要在一个页面中生成多个验证码的话，entry方法需要传入可标识的信息，例如：
验证码1：</p>

<pre><code>// 验证码1
$Verify = new \Think\Verify();
$Verify-&gt;entry(1);
</code></pre>

<p>验证码2：</p>

<pre><code>// 验证码2
$Verify = new \Think\Verify();
$Verify-&gt;entry(2);
</code></pre>

<h2>验证码参数</h2>

<p>可以对生成的验证码设置相关的参数，以达到不同的显示效果。
这些参数包括：</p>

<table>
<thead>
<tr>
  <th>参数</th>
  <th>描述</th>
</tr>
</thead>
<tbody>
<tr>
  <td>expire</td>
  <td>验证码的有效期（秒）</td>
</tr>
<tr>
  <td>useImgBg</td>
  <td>是否使用背景图片  默认为false</td>
</tr>
<tr>
  <td>fontSize</td>
  <td>验证码字体大小（像素）   默认为25</td>
</tr>
<tr>
  <td>useCurve</td>
  <td>是否使用混淆曲线 默认为true</td>
</tr>
<tr>
  <td>useNoise</td>
  <td>是否添加杂点  默认为true</td>
</tr>
<tr>
  <td>imageW</td>
  <td>验证码宽度 设置为0为自动计算</td>
</tr>
<tr>
  <td>imageH</td>
  <td>验证码高度 设置为0为自动计算</td>
</tr>
<tr>
  <td>length</td>
  <td>验证码位数</td>
</tr>
<tr>
  <td>fontttf</td>
  <td>指定验证码字体 默认为随机获取</td>
</tr>
<tr>
  <td>useZh</td>
  <td>是否使用中文验证码</td>
</tr>
<tr>
  <td>bg</td>
  <td>验证码背景颜色 rgb数组设置，例如 array(243, 251, 254)</td>
</tr>
<tr>
  <td>seKey</td>
  <td>验证码的加密密钥</td>
</tr>
<tr>
  <td>codeSet</td>
  <td>验证码字符集合    3.2.1 新增</td>
</tr>
<tr>
  <td>zhSet</td>
  <td>验证码字符集合（中文）  3.2.1 新增</td>
</tr>
</tbody>
</table>

<p>参数设置使用两种方式。</p>

<p>实例化传入参数：</p>

<pre><code>$config =    array(
    'fontSize'    =&gt;    30,    // 验证码字体大小
    'length'      =&gt;    3,     // 验证码位数
    'useNoise'    =&gt;    false, // 关闭验证码杂点
);
$Verify =     new \Think\Verify($config);
$Verify-&gt;entry();
</code></pre>

<p>或者采用动态设置的方式，如：</p>

<pre><code>$Verify =     new \Think\Verify();
$Verify-&gt;fontSize = 30;
$Verify-&gt;length   = 3;
$Verify-&gt;useNoise = false;
$Verify-&gt;entry();
</code></pre>

<p>生成的验证码如图所示：</p>

<p><img src="../images/img/7.png" alt="localhost" /></p>

<h3>验证码字体</h3>

<p>默认情况下，验证码的字体是随机使用 <code>ThinkPHP/Library/Think/Verify/ttfs/</code>目录下面的字体文件，我们可以指定验证码的字体，例如：</p>

<pre><code>$Verify =     new \Think\Verify();
// 验证码字体使用 ThinkPHP/Library/Think/Verify/ttfs/5.ttf
$Verify-&gt;fontttf = '5.ttf'; 
$Verify-&gt;entry();
</code></pre>

<h3>背景图片</h3>

<p>支持验证码背景图片功能，可以如下设置：</p>

<pre><code>$Verify =     new \Think\Verify();
// 开启验证码背景图片功能 随机使用 ThinkPHP/Library/Think/Verify/bgs 目录下面的图片
$Verify-&gt;useImgBg = true; 
$Verify-&gt;entry();
</code></pre>

<p>效果如图所示：</p>

<p><img src="../images/img/8.png" alt="localhost(2)" /></p>

<h3>中文验证码</h3>

<p>如果要使用中文验证码，可以设置：</p>

<pre><code>$Verify =     new \Think\Verify();
// 验证码字体使用 ThinkPHP/Library/Think/Verify/ttfs/5.ttf
$Verify-&gt;useZh = true; 
$Verify-&gt;entry();
</code></pre>

<p>显示效果如图：</p>

<p><img src="../images/img/9.png" alt="logo" /></p>

<blockquote>
  <p>如果无法正常显示，请确认你的 ThinkPHP/Library/Think/Verify/zhttfs/ 目录下面存在中文字体文件。</p>
</blockquote>

<h3>指定验证码字符</h3>

<p><strong>3.2.1</strong>版本以上，我们可以指定验证码的字符，通过重新设置<strong>codeSet</strong>参数即可，例如：</p>

<pre><code>$Verify =     new \Think\Verify();
// 设置验证码字符为纯数字
$Verify-&gt;codeSet = '0123456789'; 
$Verify-&gt;entry();
</code></pre>

<p>如果是中文验证码，可以使用<strong>zhSet</strong>参数设置，例如：</p>

<pre><code>$Verify =     new \Think\Verify();
$Verify-&gt;useZh = true;
// 设置验证码字符
$Verify-&gt;zhSet = '们以我到他会作时要动国产的一是工就年阶义发成部民可出能方进在了不和有大这'; 
$Verify-&gt;entry();
</code></pre>

<h2>验证码检测</h2>

<p>可以用Think\Verify类的<code>check</code>方法检测验证码的输入是否正确，例如，下面是封装的一个验证码检测的函数：</p>

<pre><code>// 检测输入的验证码是否正确，$code为用户输入的验证码字符串
function check_verify($code, $id = ''){
    $verify = new \Think\Verify();
    return $verify-&gt;check($code, $id);
}
</code></pre>
</div>
		<div class="book-footer">
			<div class="page"><a title="上一页" class="prev" href="192.html"><span>上一页</span></a><a title="下一页" class="next" href="194.html"><span>下一页</span></a></div>
		</div>
	</body>
</html>
