var app=angular.module("app",["ionic","ngStorage","ionicLazyLoad"]);app.config(["$ionicConfigProvider","$sceDelegateProvider",function(e,o){e.scrolling.jsScrolling(!1)}]),app.config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]),app.factory("AuthInterceptor",["$rootScope","$q","$location","$timeout","$window",function(e,o,t,n,i){return{response:function(e,o){t.path(),e.headers();return e}}}]),app.run(["$ionicViewSwitcher","$window","$rootScope","$state","$stateParams","$localStorage","$http","$q","$location",function(e,o,r,t,n,i,a,c,s){r.$state=t,r.$stateParams=n,r.$goback=function(){o.history.back(),e.nextDirection("back")},r.$refresh=function(){o.location.reload()},r.$on("$stateChangeSuccess",function(e,o,t,n,i,a){r.previousState=n,r.previousStateParams=i}),r.$on("$stateChangeStart",function(e,o,t,n,i){ionic.Platform.setPlatform("ios")})}]),app.constant("WAP_CONFIG",{host:"https://api.avgle.com",port:443,path:"/v1/",platform:"browser"}),app.config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("app",{url:"/app",templateUrl:"tpl/app.html?v="+$tplVersion,abstract:!0}).state("app.home",{url:"/home",views:{"tab-home":{templateUrl:"tpl/home.html?v="+$tplVersion,controller:"homeCtrl",cache:!0}}}).state("app.list",{url:"/list?key",views:{"tab-list":{templateUrl:"tpl/list.html?v="+$tplVersion,controller:"listCtrl",cache:!0}}}).state("app.person",{url:"/person",views:{"tab-person":{templateUrl:"tpl/person.html?v="+$tplVersion,controller:"personCtrl",cache:!0}}}).state("view",{url:"/view",templateUrl:"tpl/view.html?v="+$tplVersion,controller:"viewCtrl",cache:!0}).state("star",{url:"/star",templateUrl:"tpl/star.html?v="+$tplVersion,controller:"starCtrl",cache:!0}),o.otherwise("/app/home")}]),app.directive("ionImg",function(){return{scope:{ngsrc:"@",ngopt:"@"},link:function(e,o){var t=e.ngsrc,n=e.ngopt,i=angular.element(o)[0];if(i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAnCAIAAAADwcZiAAAAW0lEQVRYCe3SMQ7AMAzDwLb//6k/UWTnyGQJPWqQgIPfmXmO33d8cQ22ups94YQ9gb7Js+SmhNnFSxP2LLkpYXbx0oQ9S25KmF28NGHPkpsSZhcvTdiz5KabhH9OFAMPqToRyQAAAABJRU5ErkJggg==",n){var a=(n=n.split(","))[0],r=n[1];i.width=screen.width+parseInt(a),i.height=i.width*r}var c=new Image;c.src=t,c.onload=function(){i.src=t}}}}),app.directive("rjHoldActive",["$timeout",function(i){return{restrict:"AE",replace:!1,link:function(e,o,t,n){o.bind("click",function(e){var o=document.getElementById("ripple");o.classList?o.classList.add("animate"):o.className+=" animate",o.style.left=e.pageX-20+"px",o.style.top=e.pageY-20+"px",i(function(){o.style.left="-40px",o.style.top="-40px",o.classList?o.classList.remove("animate"):o.className=o.className.replace("animate","")},200)})}}}]),angular.module("ionicLazyLoad",[]),angular.module("ionicLazyLoad").directive("lazyScroll",["$rootScope",function(n){return{restrict:"A",link:function(e,o){var t=e.$onScroll;e.$onScroll=function(){n.$broadcast("lazyScrollEvent"),"function"==typeof t&&t()}}}}]).directive("imageLazySrc",["$document","$timeout","$ionicScrollDelegate","$compile",function(l,u,o,g){return{restrict:"A",scope:{lazyScrollResize:"@lazyScrollResize",imageLazyBackgroundImage:"@imageLazyBackgroundImage",imageLazySrc:"@"},link:function(n,i,a){var r;a.imageLazyDistanceFromBottomToLoad||(a.imageLazyDistanceFromBottomToLoad=0),a.imageLazyDistanceFromRightToLoad||(a.imageLazyDistanceFromRightToLoad=0),a.imageLazyLoader&&(r=g('<div class="image-loader-container"><ion-spinner class="image-loader" icon="'+a.imageLazyLoader+'"></ion-spinner></div>')(n),i.after(r)),n.$watch("imageLazySrc",function(e,o){r&&r.remove(),a.imageLazyLoader&&(r=g('<div class="image-loader-container"><ion-spinner class="image-loader" icon="'+a.imageLazyLoader+'"></ion-spinner></div>')(n),i.after(r));var t=n.$on("lazyScrollEvent",function(){s()&&(c(),t())});u(function(){s()&&(c(),t())},500)});var e=n.$on("lazyScrollEvent",function(){s()&&(c(),e())});function c(){if(i.bind("load",function(e){a.imageLazyLoader&&r.remove(),"true"==n.lazyScrollResize&&o.resize(),i.unbind("load")}),i.bind("error",function(e){this.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAnCAIAAAADwcZiAAAAW0lEQVRYCe3SMQ7AMAzDwLb//6k/UWTnyGQJPWqQgIPfmXmO33d8cQ22ups94YQ9gb7Js+SmhNnFSxP2LLkpYXbx0oQ9S25KmF28NGHPkpsSZhcvTdiz5KabhH9OFAMPqToRyQAAAABJRU5ErkJggg=="}),"true"==n.imageLazyBackgroundImage){var e=new Image;e.onload=function(){a.imageLazyLoader&&r.remove(),i[0].style.backgroundImage="url("+a.imageLazySrc+")","true"==n.lazyScrollResize&&o.resize()},e.src=a.imageLazySrc}else i[0].src=a.imageLazySrc}function s(){var e=l[0].documentElement.clientHeight,o=l[0].documentElement.clientWidth,t=i[0].getBoundingClientRect();return 0<=t.top&&t.top<=e+parseInt(a.imageLazyDistanceFromBottomToLoad)&&0<=t.left&&t.left<=o+parseInt(a.imageLazyDistanceFromRightToLoad)}i.on("$destroy",function(){e()}),u(function(){s()&&(c(),e())},500)}}}]),function(){function e(s){return["$rootScope","$window",function(o,e){for(var t,n,i,a=e[s]||(console.warn("This browser does not support Web Storage!"),{}),r={$default:function(e){for(var o in e)angular.isDefined(r[o])||(r[o]=e[o]);return r},$reset:function(e){for(var o in r)"$"===o[0]||delete r[o];return r.$default(e)}},c=0;c<a.length;c++)(i=a.key(c))&&"ngStorage-"===i.slice(0,10)&&(r[i.slice(10)]=angular.fromJson(a.getItem(i)));return t=angular.copy(r),o.$watch(function(){n||(n=setTimeout(function(){if(n=null,!angular.equals(r,t)){for(var e in angular.forEach(r,function(e,o){angular.isDefined(e)&&"$"!==o[0]&&a.setItem("ngStorage-"+o,angular.toJson(e)),delete t[o]}),t)a.removeItem("ngStorage-"+e);t=angular.copy(r)}},100))}),"localStorage"===s&&e.addEventListener&&e.addEventListener("storage",function(e){"ngStorage-"===e.key.slice(0,10)&&(e.newValue?r[e.key.slice(10)]=angular.fromJson(e.newValue):delete r[e.key.slice(10)],t=angular.copy(r),o.$apply())}),r}]}angular.module("ngStorage",[]).factory("$localStorage",e("localStorage")).factory("$sessionStorage",e("sessionStorage"))}(),app.factory("$loading",["$ionicLoading",function(l){return{show:function(e,o,t,n){var i=e||!1,a=t||"ios",r=n||"",c=o||"",s=i?"<style>.loading-container .loading{background-color: rgba(0, 0, 0,0.6);}</style>":"<style>.loading-container .loading{background-color: rgba(0, 0, 0,0.2);}</style>";l.show({template:s+'<ion-spinner icon="'+a+'" class="'+r+'"></ion-spinner><div>'+c+"</div>",content:"Loading",animation:"",showBackdrop:i,minWidth:500,showDelay:0})},hide:function(){l.hide()}}}]),app.factory("$confirm",["$ionicPopup",function(c){return{show:function(e,o,t){var n=e.title||"提示",i=e.content||"",a=o||function(){},r=t||function(){};c.confirm({template:i,title:n,buttons:[{text:"确定",type:"button-positive",onTap:function(e){return 1}},{text:"取消",type:"button-assertive"}]}).then(function(e){e?a():r()})}}}]),app.filter("Datetranslater",function(){return function(e){var o=e,t=new Date(o),n=(new Date).getTime();return t.toDateString()===(new Date).toDateString()?i(t,"HH:mm"):n-o<5184e5?i(t,"w HH:mm"):t.getMonth()==(new Date).getMonth()&&t.getFullYear()==(new Date).getFullYear()?i(t,"MM-dd HH:mm"):(t.getFullYear(),(new Date).getFullYear(),i(t,"yyyy-MM-dd HH:mm"))};function i(e,o){o=o||"yyyy-MM-dd HH:mm:ss";var i={y:(e="number"==typeof(e=null==e?new Date:e)?new Date(e):e).getFullYear(),M:e.getMonth()+1,d:e.getDate(),q:Math.floor((e.getMonth()+3)/3),w:e.getDay(),H:e.getHours(),h:e.getHours()%12==0?12:e.getHours()%12,m:e.getMinutes(),s:e.getSeconds(),S:e.getMilliseconds()},a=["日","一","二","三","四","五","六"];for(var r in i)o=o.replace(new RegExp(r+"+","g"),function(e){var o=i[r]+"";if("w"==r)return(2<e.length?"星期":"周")+a[o];for(var t=0,n=o.length;t<e.length-n;t++)o="0"+o;return 1==e.length?o:o.substring(o.length-e.length)});return o}}),app.factory("Api",["$http","WAP_CONFIG","$q","$log","$ionicLoading","$timeout",function(t,e,n,a,r,c){var o=e,s=o.host+":"+o.port+o.path;return{endpoint:s,post:function(e,o){e=s+e;var i=n.defer();return r.show({template:"加载中..."}),(null!=o&&null!=o&&""!=o?t.post(e,o,{timeout:5e3}):t.post(e,{timeout:5e3})).success(function(e,o,t,n){i.resolve(e),r.hide()}).error(function(e,o){i.reject(e),a.error(e,o),r.hide(),r.show({template:"出错了..."}),c(function(){r.hide()},1e3)}),i.promise},get:function(e,o){e=s+e;var i=n.defer();return r.show({template:"加载中..."}),(null!=o&&null!=o&&""!=o?t.get(e,o,{timeout:5e3}):t.get(e,{timeout:5e3})).success(function(e,o,t,n){i.resolve(e),r.hide()}).error(function(e,o){i.reject(e),r.hide(),a.error(e,o),r.show({template:'<i class="icon ion-android-warning assertive"></i> 出错了'}),c(function(){r.hide()},1e3)}),i.promise}}}]),app.controller("homeCtrl",["$ionicListDelegate","$state","$ionicViewSwitcher","$localStorage","$sessionStorage","$scope","$stateParams","Api","$ionicScrollDelegate","$rootScope","$location",function(i,o,t,a,e,r,n,c,s,l,u){function g(){var e,o,t,n,i,a;r.page=0,r.has_more=!0,r.videos=[],r.position="",n=e||"mr",i=o||1,a=t||5,c.get("videos/"+i+"?o="+n+"&limit="+a).then(function(e){e.success&&(r.slideVideos=e.response.videos)})}r.allVideo=function(e,o,t){var n=e||"mv",i=o||1;1==i&&(r.searchKey="",r.page=1,r.videos=[],s.$getByHandle("listScroll").scrollTop(!0));var a=t||10;c.get("videos/"+i+"?o="+n+"&limit="+a).then(function(e){e.success&&(r.has_more=e.response.has_more,r.videos=r.videos.concat(e.response.videos),r.$broadcast("scroll.infiniteScrollComplete"))})},r.loadNextPage=function(){r.page++,r.allVideo("mv",r.page)},r.view=function(e){a.video=e,o.go("view"),t.nextDirection("forward")},r.save=function(e){var o=a.saveList||[],t=!1;for(var n in o)if(o[n].vid==e.vid){t=!0;break}t||o.push(e),a.saveList=o,i.closeOptionButtons()},r.$on("$ionicView.loaded",function(){console.log("home","$ionicView.loaded"),g()}),r.scroll=function(){var e=s.$getByHandle("listScroll").getScrollPosition();l.homePosition=e}}]),app.controller("listCtrl",["$ionicListDelegate","$state","$ionicViewSwitcher","$timeout","$localStorage","$sessionStorage","$scope","$stateParams","Api","$ionicScrollDelegate","$rootScope","$location",function(i,o,t,e,a,n,c,r,s,l,u,g){function p(){c.categoryId="1",c.searchKey=g.search().key||"",c.page=0,c.videos=[],c.has_more=!0,s.get("categories").then(function(e){e.success&&(c.categories=e.response.categories,c.categoryId="1")})}function d(){document.getElementById("input_key").blur(),document.getElementById("select_cate").blur()}c.focus=function(){e(function(){l.$getByHandle("contentScroll").resize()},500)},c.changeSearchKey=function(e){e||c.clearKey()},c.clearKey=function(){d(),c.getVideoByCHID(c.categoryId)},c.getVideoByCHID=function(e,o,t){c.categoryId=e,c.has_more=!0;var n=o||1;1==n&&(c.searchKey="",c.page=1,c.videos=[]);var i=t||10;s.get("videos/"+n+"?c="+e+"&limit="+i).then(function(e){e.success&&(c.$broadcast("scroll.infiniteScrollComplete"),c.has_more=e.response.has_more,c.videos=c.videos.concat(e.response.videos))})},c.searchVideo=function(e,o,t){var n=o||1;1==n&&(c.page=1,c.videos=[]);var i=e||"",a=t||15,r=g.search().key==c.searchKey?"jav":"search";s.get(r+"/"+encodeURIComponent(i)+"/"+n+"?limit="+a).then(function(e){e.success&&(c.has_more=e.response.has_more,c.videos=c.videos.concat(e.response.videos),c.$broadcast("scroll.infiniteScrollComplete"))})},c.loadNextPage=function(){c.page++,c.searchKey?c.searchVideo(c.searchKey,c.page):c.getVideoByCHID(c.categoryId,c.page)},c.view=function(e){a.video=e,o.go("view"),t.nextDirection("forward")},c.save=function(e){var o=a.saveList||[],t=!1;for(var n in o)if(o[n].vid==e.vid){t=!0;break}t||o.push(e),a.saveList=o,i.closeOptionButtons()},c.submit=function(e,o){c.searchVideo(o),d()},c.change=function(e,o){c.getVideoByCHID(o),d()},c.$on("$ionicView.loaded",function(){console.log("list","$ionicView.loaded"),p()})}]),app.controller("personCtrl",["$scope","$localStorage",function(e,o){e.$on("$ionicView.loaded",function(){console.log("person","$ionicView.loaded")})}]),app.controller("starCtrl",["$ionicViewSwitcher","$state","$ionicListDelegate","$rootScope","$location","$ionicScrollDelegate","$loading","$scope","$http","$sessionStorage","$localStorage",function(o,t,n,e,i,a,r,c,s,l,u){c.$on("$ionicView.enter",function(e){c.videos=u.saveList,console.log("star","$ionicView.enter")}),c.delete=function(e){c.videos.splice(e,1),u.saveList=c.videos,n.closeOptionButtons()},c.view=function(e){u.video=e,t.go("view"),o.nextDirection("forward")}}]),app.controller("viewCtrl",["$state","$localStorage","$sessionStorage","$scope","$stateParams","Api","$ionicScrollDelegate","$rootScope","$location","$sce",function(o,i,e,r,t,c,s,n,a,l){r.$on("$ionicView.enter",function(e){r.page=0,r.has_more=!0,r.videos=[],r.video=i.video,r.allVideo(r.page),r.video_src=l.trustAsResourceUrl(r.video.embedded_url),console.log("view","$ionicView.enter")}),r.$on("$ionicView.beforeLeave",function(e){r.video_src=void 0,console.log("view","$ionicView.beforeLeave")}),r.allVideo=function(e,o,t){var n=e||"mv",i=o||1;1==i&&(r.searchKey="",r.page=1,r.videos=[],s.$getByHandle("listScroll").scrollTop(!0));var a=t||15;c.get("videos/"+i+"?o="+n+"&limit="+a).then(function(e){e.success&&(r.has_more=e.response.has_more,r.videos=r.videos.concat(e.response.videos),r.$broadcast("scroll.infiniteScrollComplete"))})},r.loadNextPage=function(){r.page++,r.allVideo("",r.page)},r.save=function(e){var o=i.saveList||[],t=!1;for(var n in o)if(o[n].vid==e.vid){t=!0;break}t||o.push(e),i.saveList=o,$ionicListDelegate.closeOptionButtons()},r.view=function(e){i.video=e,o.go("view",{},{reload:!0})}}]);