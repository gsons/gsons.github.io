<extend name="Tpl:Base"/>
<block name="body">
    <!-- Main content -->
    <section class="content">
        <a href="#" class="ion-reply history-back" onclick="history.back(1)">&nbsp;返回</a>
        <div class="nav-tabs-custom">
            <form action="" id="form">
                <div class="box box-success">
                    <div class="box-header with-border">
                        <h3 class="box-title">角色/组管理</h3>
                    </div>
                    <div class="box-body">
                        <div class="form-group">
                            <label><span class="text-red">*</span> 角色/组名称：</label>
                            <input type="text" class="form-control" placeholder="请输入角色/组的名称" name="title"
                                   value="{$info.title}">
                        </div>
                        <br>
                        <div class="form-group">
                            <label>责任邮箱（可用英文逗号“,”分割分开）：</label>
                            <input type="text" class="form-control" placeholder="请输入责任邮箱" name="email"
                                   value="{$info.email}">
                        </div>
                        <br>
                        <div class="form-group">
                            <label>编号：</label>
                            <input type="text" class="form-control" placeholder="编号" name="number"
                                   value="{$info.number}">
                        </div>
                        <br>
                        <div class="form-group">
                            <label>简写：</label>
                            <input type="text" class="form-control" placeholder="编号" name="abbreviation"
                                   value="{$info.abbreviation}">
                        </div>
                        <br>
                        <div class="form-group">
                            <label>系列编码：</label>
                            <input type="text" class="form-control" placeholder="编号" name="serial_number"
                                   value="{$info.serial_number}">
                        </div>
                        <br>
                        <div class="form-group">
                            <label><span class="text-red">*</span> 分类：</label>
                            <select name="category_id" class="form-control select2 select2-hidden-accessible"
                                    style="width: 100%;" tabindex="-1" aria-hidden="true">
                                <option value="">请选择分类</option>
                                <volist name="type" id="vo">
                                    <option value="{$vo.id}"
                                    <eq name="info.category_id" value="$vo.id"> selected</eq>
                                    >{$vo.name}</option>
                                </volist>
                            </select>
                        </div>
                        <br>
                        <div class="form-group rules-list">
                            <label>权限列表：</label>
                            <br />
                            <br />
                            <input type="checkbox" data-name="rules[]" data-check="check-all" /> <label>全选/全不选</label>
                            <input type="checkbox" data-name="rules[]" data-check="check-opposite" /> <label>反选</label>
                            <hr/>
                            <PHP>
                                $ids = explode(',',$info['rules']);
                            </PHP>
                            <volist name="top" id="item">
                                <div>
                                    <h4 style="border-bottom:1px solid #ccc;display:block;width:220px;padding-bottom:10px;margin-bottom:15px"><input type="checkbox" name="rules[]" value="{$item.id}" {:checkPoint($ids,$item["id"])} > {$item.name}</h4>
                                    <ul class="Authlist">
                                        <volist name="item.child" id="vo">
                                            <li>
                                                <div class="checkbox-control">
                                                    <input type="checkbox" name="rules[]" value="{$vo.id}" {:checkPoint($ids,$vo["id"])} >
                                                    <label>{$vo.name}</label>
                                                </div>
                                            </li>
                                        </volist>
                                        <div class="clear"></div>
                                    </ul>
                                    <hr/>
                                </div>
                            </volist>
                            <div class="clear"></div>
                        </div>
                        <br>
                    </div>
                    <!-- /.box-body -->
                    <div class="box-footer">
                        <input type="hidden" name="id" value="{:I('get.id')}" />
                        <button type="button" class="btn btn-primary ajax-submit ajax-post" data-form="form">提交</button>
                    </div>
                </div>
            </form>
        </div>
    </section>
    <!-- /.content -->
</block>
<block name="script">
    <script>
        $.each( $('.rules-list h4 input'), function(){
            var obj = $(this);
            $.each(  $(this).parent().parent().next().find('input') ,function(){
                if( $(this).prop('checked') ){
                    obj.iCheck('check')
                }
            })
            if( !$(this).prop('checked') ){
                $(this).parent().parent().next().find('input').iCheck('disable');
            }else{
                $(this).parent().parent().next().find('input').iCheck('enable');
            }
        })

        $('.rules-list h4 input').on('ifChanged',(function(){
            if( $(this).prop('checked') ){
                $(this).parent().parent().next().find('input').iCheck('enable');
                $(this).parent().parent().next().find('input').iCheck('check');
            }else{
                $(this).parent().parent().next().find('input').iCheck('disable');
            }
        }))

    </script>
</block>