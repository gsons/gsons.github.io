<extend name="Tpl:Base" />
<block name="body">
    <!-- Main content -->
    <section class="content">

        <div class="box">
            <div class="box-header">
                <h3 class="box-title iframe-title">公众号管理</h3>
                <neq name="static" value="1">
                    <div class="btn-toolbar">
                        <a class="btn btn-success" href="{:U('Wechat/OpenEdit')}">新增</a>
                    </div>
                </neq>
            </div><!-- /.box-header -->
            <div class="box-body no-padding">
                <table class="table table-striped">
                    <tbody>
                    <tr>
                        <!--<th><input type="checkbox" id="check-all"/></th>-->
                        <th>公众号名称</th>
                        <th>请求数</th>
                        <th>URL(服务器地址)</th>
                        <th>Token(令牌)</th>
                        <th>状态</th>
                        <th>更新时间</th>
                        <th>绑定时间</th>
                        <th>操作</th>
                    </tr>
                    <volist name="list" id="vo">
                        <tr>
                            <!--<td><input type="checkbox" name="ids[]" value="{$vo.id}"/></td>-->
                            <td>{$vo.name}</td>
                            <td>{$vo.apply_times}</td>
                            <td>http://{:C('DOMAIN')}__ROOT__/index.php/Wechat/Index/wid/{$vo.id}.html</td>
                            <td>{$vo.token}</td>
                            <td><eq name="vo.status" value="1"><span class="green">已接入</span> <else /> <span class="red">未接入</span></eq></td>
                            <td>{$vo.update_date|FormatDate}</td>
                            <td>{$vo.create_date|FormatDate}</td>
                            <td>
                                <a href="javascript:" class="setCurrent" data-href="{:U('Set',array('id'=>$vo['id']))}" <eq name="vo.id" value="$wid">class="on"</eq>><eq name="vo.id" value="$wid"><span class="red">已设置</span><else />设为当前 </eq></a>
                                <a href="{:U('Wechat/OpenEdit',array('id'=>$vo['id']))}">编辑</a>
                                <a href="javascript:" data-href="{:U('',array('id'=>$vo['id']))}" class="ajax-submit ajax-del">删除</a>
                            </td>
                        </tr>
                    </volist>
                    </tbody></table>
            </div><!-- /.box-body -->
            <div class="box-footer">
                <!--<ul class="pagination">
                    <li class="paginate_button previous disabled"><a href="#" >上一页</a> </li>
                    <li class="paginate_button active"><a href="#">1</a></li>
                    <li class="paginate_button "><a href="#">2</a></li>
                    <li class="paginate_button next"><a href="#">下一页</a></li>
                </ul>-->
                {$page}
            </div>
        </div>

    </section><!-- /.content -->
</block>
<block name="script">
    <style>
        .on { font-weight:bold; }
    </style>
    <script>
        $('.setCurrent').click(function(){
            var url = $(this).attr('data-href');
            $.ajax({
                url:url,
                beforeSend:function(){
                    loading();
                },
                success:function(){
                    layer.msg('设置成功，系统刷新中',{icon:1},function(){
                        window.parent.location.reload()
                    })
                },
                error:function(){
                    layer.msg('设置失败',{icon:0})
                }
            })
        })
    </script>
</block>