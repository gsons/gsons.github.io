<extend name="Tpl:Basic" />
<block name="body">
    <div class="box box-success">
        <div class="box-body">
            <table class="table table-striped">
                <tr>
                    <td>图文消息</td>
                    <td class="status danger red">等待同步</td>
                    <td class="count">0%</td>
                </tr>
            </table>
        </div>
        <div class="box-footer">
            <button type="button" class="btn btn-success" onclick="Sync(0);">开始同步</button>
        </div>
    </div>
</block>
<block name="script">
    <!--layer-->
    <link rel="stylesheet" href="__PLUS__/layer/skin/layer.css"/>
    <script src="__PLUS__/layer/layer.js"></script>
    <script>
        function Sync(p){
            $('.table tr').find('.status').html('正在同步');
            $.ajax({
                url:'',
                data:'p='+p,
                dataType:'json',
                beforeSend:'',
                success:function(data){
                    $('.table tr').find('.count').html(data.percent)
                    if(data.status == '1'){
                        $('.table tr').find('.status').html('同步完成').removeClass('danger red').addClass('success green');
                        layer.msg(data.info,{icon:1,time:3000},function(){
                            parent.window.location.reload();
                        })
                        return false;
                    }else{
                        layer.msg(data.info,{icon:0});
                        return false;
                    }
                    Sync(data.p);
                }
            })
        }
    </script>
</block>