<span class="text-red">*</span> <extend name="Tpl:Base"/>
<block name="body">
<style>
    .delete a{
        font-size: 20px;
        position: absolute;
        right: 50px;
    }
</style>
    <!-- Main content -->
    <section class="content">
        <a href="#" class="ion-reply history-back" onclick="history.back(1)">&nbsp;返回</a>
        <div class="nav-tabs-custom">
            <form action="" id="form">
                <div class="box box-success">
                    <div class="box-header with-border">
                        <h3 class="box-title">问卷增加/修改</h3>
                    </div>
                    <div class="box-body">
                        <div class="form-group">
                            <label><span class="text-red">*</span> 标题：</label>
                            <input type="text" class="form-control" placeholder="标题" name="title" value="{$info.title}">
                        </div>
                        <br>

                        <div class="form-group">
                            <label><span class="text-red">*</span> 问卷开始日期</label>
                            <input type="text" class="form-control date" name="start_time" value="{: empty($info['start_time'])? date('Y-m-d',NOW_TIME) :date('Y-m-d',$info['start_time'])}">
                        </div>
                        <br>

                        <div class="form-group">
                            <label><span class="text-red">*</span> 问卷结束日期</label>
                            <input type="text" class="form-control date" name="end_time" value="{: empty($info['end_time'])? date('Y-m-d',calc_workday()) :date('Y-m-d',$info['end_time'])}">
                        </div>
                        <br>

                        <div><button type="button" class="btn btn-info" onclick="add_vote()">新增一个题目</button>
                        </div>
                        <br>

                        <div id="option" data-num="{: empty($info['Vote']) ? 1 : count($info['Vote']) }">
                            <?php if(empty($info['Vote'])):?>
                                <div class="form-group delete" style="padding: 10px;border: 1px solid #00acd6; ">
                                    <a href="javascript:void(0);" onclick="del_dom(this)">X</a>
                                    <label><span class="text-red">*</span> 题目：</label>
                                    <input type="text" class="form-control" placeholder="请输入题目内容" name="vote[0][title]" value="">
                                    <div>
                                    <button type="button" class="btn btn-info" onclick="add_option(this,'0')">新增一个选项</button>
                                    </div>
                                    <div>
                                        <div class="form-group delete " style="padding: 10px;border: 1px solid #00c0ef;  margin: 10px;">
                                            <a href="javascript:void(0);" onclick="del_dom(this)">X</a>
                                            <label>选项：</label>
                                            <input type="text" class="form-control" placeholder="请输入题目选项" name="vote[0][VoteOption][][content]" value="">
                                        </div>
                                        <div class="form-group delete " style="padding: 10px;border: 1px solid #00c0ef;  margin: 10px;">
                                            <a href="javascript:void(0);" onclick="del_dom(this)">X</a>
                                            <label>选项：</label>
                                            <input type="text" class="form-control" placeholder="请输入题目选项" name="vote[0][VoteOption][][content]" value="">
                                        </div>
                                    </div>
                                </div>
                                <br>
                                <br>
                            <?php else:?>
                            <volist name="info.Vote" id="vo" key="k">
                               <div class="form-group delete " data=num="{:  count($info['Vote']) }" style="padding: 10px;border: 1px solid #00acd6; ">
                                    <a href="javascript:void(0);" onclick="del_dom(this)">X</a>
                                    <label><span class="text-red">*</span> 题目：</label>
                                    <input type="text" class="form-control" placeholder="请输入题目内容" name="vote[{$k}][title]" value="{$vo.title}">
                                    <input type="hidden" name="vote[{$k}][id]" value="{$vo.id}">
                                    <div><button type="button" class="btn btn-info" onclick="add_option(this,'{$k}')">新增一个选项</button>
                                    </div>
                                    <div>
                                    <volist name=":get_option($vo['id'])" id="v">
                                        <div class="form-group delete " style="padding: 10px;border: 1px solid #00c0ef;  margin: 10px;">
                                            <a href="javascript:void(0);" onclick="del_dom(this)">X</a>
                                            <label>选项：</label>
                                            <input type="text" class="form-control" placeholder="请输入题目选项" name="vote[{$k}][VoteOption][{$key}][content]" value="{$v.content}">
                                            <input type="hidden"  name="vote[{$k}][VoteOption][{$key}][id]" value="{$v.id}">
                                        </div>
                                    </volist>
                                    </div>
                                </div>
                                <br>
                                <br>
                            </volist>
                            <?php endif;?>
                        </div>

                        <div class="form-group">
                            <label>状态：</label>
                            <label class="checkbox-inline">
                                <input type="radio" name="status" value="1" <notempty name="info.status"><eq name="info.status" value="1">checked</eq> <else/> checked </notempty> /> 启用 &nbsp;
                            </label>
                            <label class="checkbox-inline">
                                <input type="radio" name="status" value="0" <eq name="info.status" value="0">checked</eq> /> 草稿
                            </label>
                        </div>
                        <br>
                    </div>
                    <!-- /.box-body -->
                    <div class="box-footer">
                        <input type="hidden" name="id" value="{:I('get.id')}" />
                        <button type="button" class="btn btn-primary ajax-submit ajax-post" data-form="form">提交</button>
                    </div>
                </div>
            </form>

        </div>

    </section>
    <!-- /.content -->

</block>
<block name="script">
    <script>
     function add_option(obj,num){
        $(obj).parent().next().append('<div class="form-group delete " style="padding: 10px;border: 1px solid #00c0ef;  margin: 10px;"><a href="javascript:void(0);" onclick="del_dom(this)">X</a><label>选项：</label><input type="text" class="form-control" placeholder="请输入题目选项" name="vote['+num+'][VoteOption][][content]" value=""></div>');

     }


     function add_vote(){

        var num = $('#option').attr('data-num');
        num = parseInt(num) + 1 ;
        var html = '<div class="form-group delete" style="padding: 10px;border: 1px solid #00acd6; "><a href="javascript:void(0);" onclick="del_dom(this)">X</a><label>题目：</label><input type="text" class="form-control" placeholder="请输入题目内容" name="vote['+num+'][title]" value=""><div><button type="button" class="btn btn-info" onclick="add_option(this,\''+num+'\')">新增一个选项</button></div><div><div class="form-group delete " style="padding: 10px;border: 1px solid #00c0ef;  margin: 10px;"><a href="javascript:void(0);" onclick="del_dom(this)">X</a><label>选项：</label><input type="text" class="form-control" placeholder="请输入题目选项" name="vote['+num+'][VoteOption][][content]" value=""></div><div class="form-group delete " style="padding: 10px;border: 1px solid #00c0ef;  margin: 10px;"><a href="javascript:void(0);" onclick="del_dom(this)">X</a><label>选项：</label><input type="text" class="form-control" placeholder="请输入题目选项" name="vote['+num+'][VoteOption][][content]" value=""></div></div></div><br><br>';
        $('#option').append(html);
        $('#option').attr('data-num',num);

    }

     function del_dom(obj){
        $(obj).parent().next('br').remove();
        $(obj).parent().remove();
     }
    </script>

</block>