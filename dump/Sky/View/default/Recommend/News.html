<extend name="Tpl:Base" />
<block name="body">
    <!-- Main content -->
    <section class="content">
        <div class="row">
            <div class="col-xs-8">
                <div class="box">
                    <div class="box-header">
                        <h3 class="box-title iframe-title">{: I('type_id') == 0 ? '首页推荐' : get_field(I('type_id'),'ArticleType','name') }管理</h3>
                        <div class="btn-toolbar">
                            <a class="btn btn-primary ajax-submit ajax-post ajax-del" data-form="form" data-href="{:U('enable')}">通过</a>
                            <a class="btn btn-danger ajax-submit ajax-post ajax-del" data-form="form" data-href="{:U('disable')}">禁用</a>
                        </div>
                        <form action="" method="post" id="search_form">
                            <div class="search">
                                <input type="text" name="keyword" class="form-control" placeholder="搜索标题" value="{:I('post.keyword')}">
                                <input type="submit" value="搜索" class="btn btn-info">
                            </div>
                        </form>
                    </div><!-- /.box-header -->
                    <div class="box-body no-padding">
                        <form action="" id="form">
                            <table class="table table-striped">
                                <tbody>
                                <tr>
                                    <th width="50px"><input type="checkbox" data-check="check-all" data-name="ids[]" /></th><th width="70x">操作</th><th width="70px">编号</th><th>文章标题</th><th>申请人</th><th>处理人</th><th>优先程度</th><th>申请原因</th><th width="100px">发布时间</th><th>申请日期</th><th width="50px">状态</th>
                                </tr>
                                <volist name="list" id="vo">
                                    <tr>
                                        <td><input type="checkbox" name="ids[]" value="{$vo.id}"/></td>
                                        <td>
                                            <neq name="static" value="1"><a class="ajax-submit ajax-get ajax-del" data-href="{:U('Article/ArticleEdit',array('id'=>$vo['id']))}">删除</a></neq>
                                        </td>
                                        <td>{$vo.id}</td>
                                        <td><a href="{:modelUrl(U('Article/Details',array('id'=>$vo['article_id'])),'index')}" target="_blank">{$vo.article_title}</a></td>
                                        <td>{$vo.admin_id|getAdminName}</td>
                                        <td>{$vo.dealer_id|getAdminName}</td>
                                        <td width="100px">
                                            <eq name="vo.level" value="0"><span class="text-info">普通头条</span></eq>
                                            <eq name="vo.level" value="1"><span class="text-info">滚动头条</span></eq>
                                            <eq name="vo.level" value="2"><span class="text-warning">轮播头条</span></eq>
                                            <eq name="vo.level" value="3"><span class="text-danger">大字头条</span></eq>
                                        </td>
                                        <td title="{$vo.reason}" width="200px">{$vo.reason|msubstr=0,15}</td>
                                        <td>{$vo.article_create_date|howLong}</td>
                                        <td>{$vo.create_date|FormatDate}</td>
                                        <td>
                                            <eq name="vo.status" value="1">已通过</eq>
                                            <eq name="vo.status" value="0">未审核</eq>
                                        </td>
                                    </tr>
                                </volist>
                                </tbody></table>
                        </form>
                    </div><!-- /.box-body -->
                    <div class="box-footer">
                        <!--<ul class="pagination">
                            <li class="paginate_button previous disabled"><a href="#" >上一页</a> </li>
                            <li class="paginate_button active"><a href="#">1</a></li>
                            <li class="paginate_button "><a href="#">2</a></li>
                            <li class="paginate_button next"><a href="#">下一页</a></li>
                        </ul>-->
                        {$page}
                    </div>
                </div>
            </div>
            <div class="col-xs-4">
                <div class="box">
                    <div class="box-header">
                        <h3 class="box-title iframe-title">已推荐文章</h3>
                    </div><!-- /.box-header -->
                    <div class="box-body no-padding recommend-list">
                        <ul>
                            <li class="header">
                                <span class="number">序号</span>
                                <span>标题</span>
                                <em>发布时间</em>
                                <div class="clear"></div>
                            </li>
                        </ul>
                        <ul id="ing" style="padding-bottom:10px;">
                            <volist name="ing" id="vo">
                                <li data-id="{$vo.article_id}">
                                    <span class="number">{$key+1}</span>
                                    <span title="{$vo.article_title}">{$vo.article_title|msubstr=0,15}</span>
                                    <em>{$vo.article_create_date|howLong}</em>
                                    <div class="clear"></div>
                                </li>
                            </volist>
                        </ul>
                    </div><!-- /.box-body -->
                </div>
                <div class="box">
                    <div class="box-header">
                        <h3 class="box-title iframe-title">待推荐文章【拖拽至上方栏目】</h3>
                    </div><!-- /.box-header -->
                    <div class="box-body no-padding recommend-list">
                        <ul>
                            <li class="header">
                                <span class="number">序号</span>
                                <span>标题</span>
                                <em>发布时间</em>
                                <div class="clear"></div>
                            </li>
                        </ul>
                        <ul id="wait" style="padding-bottom:10px;">
                            <volist name="wait" id="vo">
                                <li data-id="{$vo.article_id}">
                                    <span class="number">{$key+1}</span>
                                    <span title="{$vo.article_title}">{$vo.article_title|msubstr=0,15}</span>
                                    <em>{$vo.article_create_date|howLong}</em>
                                    <div class="clear"></div>
                                </li>
                            </volist>
                        </ul>
                    </div><!-- /.box-body -->
                </div>
            </div>
        </div>
    </section><!-- /.content -->
</block>
<block name="script">
    <script src="__PLUS__/Sortable-master/Sortable.min.js"></script>
    <script>
        var ing = document.getElementById("ing");
        Sortable.create(ing, {
            group: "omega",
            animation : 300,
            // Element dragging ended
            onEnd: sort
        });

        var wait = document.getElementById("wait");
        Sortable.create(wait, {
            group: "omega",
            animation : 300,
            // Element dragging ended
            onEnd: sort
        });

        function sort(){
            loading();
            var type_id = "{:I('get.type_id')}"
            var art_id = new Array();
            $.each( $('#ing li'),function(){
                art_id.push($(this).attr('data-id'))
            })
            var out_id = new Array();
            $.each( $('#wait li'),function(){
                out_id.push($(this).attr('data-id'))
            })
            $.ajax({
                url : '{:U("Sort")}',
                data : { type_id: type_id, art_id: art_id, out_id: out_id },
                type : 'post',
                dataType : 'json',
                success: function(data){
                    if( data.status != '1' ){
                        layer.msg('推荐失败');
                    }
                },
                complete: loaded
            })
        }
    </script>
</block>