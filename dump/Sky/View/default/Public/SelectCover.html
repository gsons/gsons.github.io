<extend name="Tpl:Basic" />
<block name="body">
    <div class="box box-success">
        <div class="box-body">
            <div class="container-fluid">
                <div class="row">
                    <volist name="list" id="vo">
                        <a href="javascript:" onclick="ChooseCover(this)" class="col-sm-3" data-title="{$vo.title}" data-id="{$vo.id}" ><img src="__UPLOAD__/{$vo.src}" alt=""/></a>
                    </volist>
                  </div>
            </div>
        </div>
        <div class="box-footer">
            {$page}
        </div>
    </div>
</block>
<block name="script">
    <style>
        a { margin-top:20px;padding:5px!important; }
        a img { width:100%;border:1px solid #f1f1f1;padding:2px; }
    </style>
    <!--layer-->
    <link rel="stylesheet" href="__PLUS__/layer/skin/layer.css"/>
    <script src="__PLUS__/layer/layer.js"></script>
    <script>
        function ChooseCover(obj){
            var selector = '{$id}'
            var id = $(obj).attr('data-id')
            var title = $(obj).attr('data-title')
            var img = $(obj).children().eq(0).attr('src');
            var box = '<div class="box" style="max-width:400px;"><div class="box-header with-border"><h3 class="box-title">'+title+'</h3><div class="box-tools pull-right"><button data-widget="remove" class="btn btn-box-tool"><i class="fa fa-times"></i></button> </div><!-- /.box-tools --> </div> <div class="box-body" title="{$vo.description}"> <img src="'+img+'" style="width:100%;" alt=""/> </div> <input type="hidden" name="image[]" value="'+id+'"/> </div>'

            $('#editor-'+selector+' .cover .right-bar',parent.document).html('');
            $('#editor-'+selector+' .cover .right-bar',parent.document).html(box);

            var key = 1;
            $.each($('.editor',parent.document),function(data){
                if( $(this).attr('id') == 'editor-'+selector ){
                    return false;
                }
                key++;
            })

            if(key == 1){
                $('.top .img',parent.document).html('')
                $('.top .img',parent.document).html('<img src="'+img+'" style="width:100%;" alt=""/>')
            }else{
                $('.others li',parent.document).eq(parseInt(key) - 2).children().eq(1).html('')
                $('.others li',parent.document).eq(parseInt(key) - 2).children().eq(1).html('<img src="'+img+'" style="width:100%;" alt=""/>')
            }
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index)
        }
    </script>
</block>