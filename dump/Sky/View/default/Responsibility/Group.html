<extend name="Tpl:Basic" />
<block name="body">
    <form action="" id="form">
        <div class="box box-success">
            <div class="box-body">
                <div class="form-group">
                    <label>选择部门：</label>
                    <select name="group_id" class="form-control select2 select2-hidden-accessible"
                            style="width: 100%;" tabindex="-1" aria-hidden="true">
                        <volist name="group" id="vo">
                            <option value="{$vo.id}">{$vo.title}</option>
                        </volist>
                    </select>
                </div>
                <div class="form-group">
                    <button type="button" class="btn btn-info" onclick="add()">添加</button>
                </div>
                <br />
                <div class="form-group">
                    <label>已选部门：</label>
                    <select name="group[]" class="form-control"
                            style="width: 100%;" tabindex="-1" aria-hidden="true" multiple>
                        <volist name="list" id="vo">
                            <option value="{$vo.id}">{$vo.title}</option>
                        </volist>
                    </select>
                </div>
                <div class="form-group">
                    <button type="button" class="btn btn-info" onclick="remove()">删除</button>
                </div>
                <br />
            </div>
            <div class="box-footer">
                <button type="button" class="btn btn-primary ajax-close" data-form="form" onclick="save();">提交</button>
            </div>
        </div>
    </form>
</block>
<block name="script">
    <script>
        function add(){
            var selected = $('select[name=group_id] option:selected');
            var exist = false;
            var chosen = $('select[name="group[]"] option');
            $.each( chosen , function(){
                if( $(this).val() == selected.val() ){
                    layer.msg('部门已被选中')
                    exist = true;
                }
            })
            if( exist ){
                return false;
            }
             $('select[name="group[]"]').append('<option value="'+selected.attr('value')+'">'+selected.html()+'</option>')
        }

        function remove(){
            $('select[name="group[]"] option:selected').remove();
        }

        function save(){
            loaded();
            var group_id = new Array();
            $.each( $('select[name="group[]"] option'), function () {
                group_id.push($(this).attr('value'));
            } )
            $.ajax({
                url: '',
                data: { group_id: group_id },
                type: 'post',
                dataType: 'json',
                success:function(data){
                    if(data.status == '1'){
                        $('#type-{:I("get.id")} .cycle',parent.document).html('已有'+group_id.length+'个部门')
                        parent.window.location.reload();
                    }else{
                        layer.alert('提交失败');
                    }
                },
                complete:loaded
            })
        }
    </script>
</block>